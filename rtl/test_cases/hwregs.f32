HWREGS = 0xE0000000
HWREGS_SEVEN_SEG     = 0x00
HWREGS_LEDR          = 0x04
HWREGS_SW            = 0x08
HWREGS_KEY           = 0x0C
HWREGS_UART_TX       = 0x10
HWREGS_UART_RX       = 0x14
HWREGS_GPIO0         = 0x18
HWREGS_GPIO1         = 0x1C
HWREGS_MOUSE_X       = 0x20
HWREGS_MOUSE_Y       = 0x24
HWREGS_MOUSE_BUTTONS = 0x28
HWREGS_SIMULATION    = 0x2C     # Reads as 1 when running in simulation
HWREGS_TIMER         = 0x30

# ========================================
# HWREGS Test Program
# ========================================

ld   R1, HWREGS           # Base address of HWREGS

loop:

# Read switches and write to LEDs
ldw  R3, R1[HWREGS_SW]
stw  R3, R1[HWREGS_LEDR]
    
# Display the mouse X and Y coordinates
ldw  R4, R1[HWREGS_MOUSE_X]
ldw  R5, R1[HWREGS_MOUSE_Y]
and  R4, R4, 0x3FF
and  R5, R5, 0x3FF
lsl  R5, R5, 12
or   R4, R4, R5
stw  R4, R1[HWREGS_SEVEN_SEG]

# copy data from UART RX to UART TX
ldw  R6, R1[HWREGS_UART_RX]
blt R6, 0, skip_uart   # don't send if no data
stw  R6, R1[HWREGS_UART_TX]
skip_uart:

# If we are running in hardware then loop forever, otherwise exit
ldw  R6, R1[HWREGS_SIMULATION]
beq  R6, 0, loop

ret